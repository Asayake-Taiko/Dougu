bucket_definitions:
  # 1. Individual Profile Buckets (for self)
  profiles:
    parameters: SELECT id as profile_id FROM profiles WHERE id = request.user_id()
    data:
      - SELECT * FROM profiles WHERE id = bucket.profile_id

  # 2. Organization Data Bucket
  org_data:
    parameters: |
      SELECT organization_id 
      FROM org_memberships 
      WHERE user_id = request.user_id()
    data:
      - SELECT * FROM organizations WHERE id = bucket.organization_id
      - SELECT * FROM containers WHERE organization_id = bucket.organization_id
      - SELECT * FROM equipment WHERE organization_id = bucket.organization_id
      - SELECT * FROM org_memberships WHERE organization_id = bucket.organization_id

  # 3. Shared Profiles (Co-members)
  # Sync profiles of all users who are members of the same organizations as the current user.
  shared_profiles:
    parameters: |
      SELECT target_user_id 
      FROM public.related_org_members 
      WHERE viewer_id = request.user_id()
    data:
      - SELECT * FROM profiles WHERE id = bucket.target_user_id